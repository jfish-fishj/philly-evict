---
title: "Retaliatory Evictions: Complaints and Filing Dynamics"
author: "Philly Evictions Project"
date: today
format:
  pdf:
    pdf-engine: xelatex
    documentclass: article
    geometry: margin=1in
    fontsize: 11pt
    keep-tex: true
    number-sections: true
    toc: true
    include-in-header:
      text: |
        \usepackage{booktabs}
        \usepackage{dcolumn}
        \usepackage{longtable}
        \usepackage{adjustbox}
---

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = here::here())
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.width = 10,
  fig.height = 7,
  dpi = 300
)
source(file.path(here::here(), "r", "config.R"))
cfg_path <- file.path(here::here(), if (file.exists(file.path(here::here(), "config.yml"))) "config.yml" else "config.example.yml")
cfg <- read_config(cfg_path, create_dirs = FALSE)
retaliatory_time_unit <- tolower(as.character(cfg$run$retaliatory_time_unit %||% "quarter"))
period_label <- if (retaliatory_time_unit == "quarter") "quarter" else "month"
period_plural <- if (retaliatory_time_unit == "quarter") "quarters" else "months"
period_title <- if (retaliatory_time_unit == "quarter") "Quarter" else "Month"
period_adj <- if (retaliatory_time_unit == "quarter") "quarterly" else "monthly"
eviction_periods_label <- if (retaliatory_time_unit == "quarter") "eviction-quarters" else "eviction-months"
```

# Overview

This document summarizes the retaliatory eviction analysis from `r/retaliatory-evictions.r`. The script investigates whether tenant complaints (code enforcement, maintenance, etc.) are associated with subsequent eviction filings --- a pattern consistent with retaliatory eviction.

**Unit of analysis:** Building (PID) $\times$ `r period_label` panel.

**Sample:** Rental buildings from the analytic sample, 2007--2024, with a pre-COVID subsample ($\leq$ 2019).

**Key data inputs:**

- `building_data_rental_month.parquet` --- monthly complaint and violation counts by building
- `analytic_sample.csv` --- PID universe filter
- `evictions_clean` + `evict_address_xwalk` --- filing-level eviction data aggregated to PID $\times$ period
- `bldg_panel_blp` --- tenant composition (race/gender from InfoUSA)

# Empirical Strategy

## Complaint Definitions

Complaints are categorized into three types:

- **Any complaint:** `total_complaints > 0`
- **Severe complaints:** Heat, fire, drainage, property maintenance (categories most likely to indicate habitability concerns)
- **Non-severe complaints:** Building, emergency service, zoning, trash/weeds, license/business, program initiative, vacant property

## Model 1: Distributed Lag

For each complaint type $c \in \{\text{any}, \text{severe}, \text{non-severe}\}$:

$$
\text{filed\_eviction}_{it} = \sum_{k=-h}^{h} \beta_k \cdot \mathbb{1}[\text{complaint}_{i,t+k}] + \alpha_i + \gamma_t + \varepsilon_{it}
$$

where $h$ is the horizon (default 12 months or 4 quarters, depending on time unit), $\alpha_i$ are building FE, and $\gamma_t$ are period FE. Standard errors clustered by PID.

## Model 2: Local Projections DiD (LP-DiD)

Uses the `lpdid` package (Girardi) to estimate dynamic treatment effects of complaint filing on eviction filings, with:

- Window selection: prefers $\pm$24 periods, falls back to $\pm$12 if treated-unit retention drops below 60%
- Non-absorbing treatment (complaints can recur)
- Clustered by PID

## Model 3: Same-Period Retaliation

Baseline:
$$
\text{filed\_eviction}_{it} = \beta \cdot \text{filed\_complaint}_{it} + \alpha_i + \gamma_t + \varepsilon_{it}
$$

Tenant-composition augmented (tests whether retaliation varies with building demographics):
$$
\begin{aligned}
\text{filed\_eviction}_{it} =\;& \beta_0 \cdot C_{it}
 + \beta_1 \cdot C_{it} \times \widetilde{\text{Black}}_i
 + \beta_2 \cdot C_{it} \times \widetilde{\text{Female}}_i \\
& + \beta_3 \cdot C_{it} \times \widetilde{\text{Black}\times\text{Female}}_i
 + \beta_4 \cdot C_{it} \times \widetilde{\text{Coverage}}_i
 + \delta \cdot M_i + \alpha_i + \gamma_t + \varepsilon_{it}
\end{aligned}
$$

where $\widetilde{\cdot}$ denotes demeaned tenant composition and $M_i$ flags missing composition.

## Model 4: Retaliatory Targeting

Among building-periods with an eviction filing, is the eviction more likely to be retaliatory (complaint nearby) in buildings with more Black/female tenants?

$$
\text{retaliatory}_{it} = \beta_1 \cdot \widetilde{\text{Black}}_i + \beta_2 \cdot \widetilde{\text{Female}}_i + \beta_3 \cdot \widetilde{\text{Black} \times \text{Female}}_i + \delta M_i + \alpha_{\text{geo}} + \gamma_t + \varepsilon_{it}
$$

Sample restricted to eviction-filing periods. Estimated with both tract and block group FE, clustered accordingly.

## Model 5: Complaint Suppression

Current focus: a **severe-complaint PPML 4-spec ladder** testing how the `% Black` coefficient changes as we add building/neighborhood controls, a lagged maintenance-stock control, and a lagged severe-violations stock control.

$$
\text{severe\_complaints}_{it} =
\beta_1 \cdot \text{pct\_black}_i + \gamma \cdot \text{maint\_stock}_{it-1} + \delta' X_{it} + \alpha + \varepsilon_{it}
$$

Estimated with **PPML** (weighted by units, clustered by PID) on the quarterly rental panel, using:

1. `pct_black + year FE`
2. `pct_black + building / neighborhood controls + year`
3. Spec (2) + lagged maintenance stock per unit (`maint_stock_lag_rate_sev3`)
4. Spec (3) + lagged severe-violations stock per unit (`severe_viol_stock_lag_rate_sev3`)

## Bandwidth Analysis

Computes the share of eviction filings that occur within $b = 1, \ldots, B$ periods of a complaint, decomposed into:

- Same-period filings
- Within-bandwidth (but not same-period)
- Non-retaliatory (no nearby complaint)

```{r load-data}
suppressPackageStartupMessages({
  library(data.table)
  library(fixest)
  library(knitr)
  library(kableExtra)
})
source("r/config.R")
cfg <- read_config()
out_dir <- p_out(cfg, "retaliatory")
proj_root <- here::here()
retaliatory_time_unit <- tolower(as.character(cfg$run$retaliatory_time_unit %||% "quarter"))
retaliatory_stub <- paste0("retaliatory_", if (retaliatory_time_unit == "quarter") "quarterly" else "monthly")
period_label <- if (retaliatory_time_unit == "quarter") "quarter" else "month"
period_plural <- if (retaliatory_time_unit == "quarter") "quarters" else "months"
period_title <- if (retaliatory_time_unit == "quarter") "Quarter" else "Month"
period_adj <- if (retaliatory_time_unit == "quarter") "quarterly" else "monthly"
eviction_periods_label <- if (retaliatory_time_unit == "quarter") "eviction-quarters" else "eviction-months"
retaliatory_out <- function(suffix) file.path(out_dir, paste0(retaliatory_stub, "_", suffix))
include_tex_table <- function(path, max_width = "\\textwidth") {
  if (!file.exists(path)) { cat("Table not found:", path); return(invisible(NULL)) }
  lines <- readLines(path)
  txt <- paste(lines, collapse = "\n")
  has_float <- grepl("\\\\begin\\{table\\}", txt)
  if (has_float) {
    is_float <- grepl("^\\s*\\\\begin\\{table\\}|^\\s*\\\\end\\{table\\}", lines)
    is_meta  <- grepl("^\\s*\\\\caption|^\\s*\\\\label|^\\s*\\\\centering", lines)
    cap_lines <- trimws(lines[is_meta])
    inner <- lines[!is_float & !is_meta]
    cat("\\begin{table}[htbp]\n\\centering\n")
    cat(cap_lines, sep = "\n")
    cat("\n\\begin{adjustbox}{max width=", max_width, "}\n", sep = "")
    cat(inner, sep = "\n")
    cat("\n\\end{adjustbox}\n\\end{table}\n")
  } else {
    cat("\\begin{adjustbox}{max width=", max_width, "}\n", sep = "")
    cat(lines, sep = "\n")
    cat("\n\\end{adjustbox}\n")
  }
}
show_bt_slope_table <- function(path, caption, outcome_map = NULL) {
  if (!file.exists(path)) {
    cat("Building-type slope table not found:", path)
    return(invisible(NULL))
  }
  x <- fread(path)
  if (!nrow(x)) {
    cat("Building-type slope table is empty.")
    return(invisible(NULL))
  }
  x_show <- copy(x)
  x_show[, Sample := fifelse(sample == "pre", "Pre-COVID", "Full")]
  if ("outcome" %in% names(x_show)) {
    x_show[, Outcome := if (!is.null(outcome_map)) fcase(
      outcome == names(outcome_map)[1], unname(outcome_map[[1]]),
      length(outcome_map) >= 2 & outcome == names(outcome_map)[2], unname(outcome_map[[2]]),
      length(outcome_map) >= 3 & outcome == names(outcome_map)[3], unname(outcome_map[[3]]),
      default = outcome
    ) else outcome]
  }
  x_show[, FE := fifelse(fe == "tract", "Tract", "Block Group")]
  x_show[, `Slope` := fcase(
    slope_label == "pct_black", "Pct Black",
    slope_label == "pct_women", "Pct Female",
    default = slope_label
  )]
  group_col <- if ("group_level" %in% names(x_show)) {
    "group_level"
  } else if ("num_units_bin" %in% names(x_show)) {
    "num_units_bin"
  } else if ("building_type" %in% names(x_show)) {
    "building_type"
  } else {
    NULL
  }
  ref_col <- if ("ref_group_level" %in% names(x_show)) {
    "ref_group_level"
  } else if ("ref_num_units_bin" %in% names(x_show)) {
    "ref_num_units_bin"
  } else if ("ref_building_type" %in% names(x_show)) {
    "ref_building_type"
  } else {
    NULL
  }
  group_var_label <- "Group"
  if ("group_var" %in% names(x_show)) {
    gvars <- unique(na.omit(x_show$group_var))
    if (length(gvars) == 1L && gvars[[1]] == "num_units_bin") group_var_label <- "Unit bin"
    if (length(gvars) == 1L && gvars[[1]] == "building_type") group_var_label <- "Building type"
  } else if (!is.null(group_col) && identical(group_col, "num_units_bin")) {
    group_var_label <- "Unit bin"
  } else if (!is.null(group_col) && identical(group_col, "building_type")) {
    group_var_label <- "Building type"
  }
  keep <- c("Sample", if ("Outcome" %in% names(x_show)) "Outcome", "FE", "Slope",
            group_col, ref_col, "estimate", "std_error", "p_value")
  keep <- keep[!is.na(keep) & nzchar(keep)]
  keep <- keep[keep %in% names(x_show)]
  x_show <- x_show[, ..keep]
  if (!is.null(group_col) && group_col %in% names(x_show)) setnames(x_show, group_col, group_var_label)
  if (!is.null(ref_col) && ref_col %in% names(x_show)) setnames(x_show, ref_col, "Ref.")
  if ("estimate" %in% names(x_show)) setnames(x_show, "estimate", "Estimate")
  if ("std_error" %in% names(x_show)) setnames(x_show, "std_error", "SE")
  if ("p_value" %in% names(x_show)) setnames(x_show, "p_value", "$p$")
  if ("Estimate" %in% names(x_show)) x_show[, Estimate := round(Estimate, 4)]
  if ("SE" %in% names(x_show)) x_show[, SE := round(SE, 4)]
  if ("$p$" %in% names(x_show)) x_show[, `$p$` := round(`$p$`, 3)]
  char_cols <- names(x_show)[vapply(x_show, is.character, logical(1))]
  if (length(char_cols)) {
    for (cc in char_cols) {
      x_show[, (cc) := gsub("%", "\\\\%", get(cc), fixed = TRUE)]
    }
  }
  setorderv(x_show, intersect(c("Sample", "Outcome", "FE", "Slope", "Unit bin", "Building type", "Group"), names(x_show)))
  caption_tex <- gsub("% Black", "Pct Black", caption, fixed = TRUE)
  caption_tex <- gsub("% Female", "Pct Female", caption_tex, fixed = TRUE)
  kable(x_show, booktabs = TRUE, escape = FALSE, caption = caption_tex) |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 8)
}
```

# Results

## Bandwidth Summary

What share of eviction filings occur near a complaint?

```{r bandwidth-table}
band_path <- retaliatory_out("bandwidth_summary.csv")
if (file.exists(band_path)) {
  band <- fread(band_path)
  # Handle both old (bandwidth_months/same_month_share) and new column names
  bw_col <- intersect(c("bandwidth_periods", "bandwidth_months"), names(band))[1]
  sp_col <- intersect(c("same_period_share", "same_month_share"), names(band))[1]
  band_show <- band[, .(
    `Bandwidth` = get(bw_col),
    `Eviction rows` = format(eviction_rows, big.mark = ","),
    `Same period` = paste0(round(100 * get(sp_col), 1), "%"),
    `Within BW` = paste0(round(100 * within_bw_share, 1), "%"),
    `Plausible only` = paste0(round(100 * plausible_only_share, 1), "%"),
    `Non-retaliatory` = paste0(round(100 * non_retaliatory_share, 1), "%")
  )]
  kable(band_show, booktabs = TRUE,
        caption = "Share of eviction filings near a complaint, by bandwidth") |>
    kable_styling(latex_options = c("hold_position", "scale_down"))
} else {
  cat("Bandwidth summary not found. Run retaliatory-evictions.r first.")
}
```

\newpage

## Distributed Lag Estimates

```{r distlag-plot, fig.cap="Distributed-lag coefficients: effect of complaint indicator at lag/lead $k$ on eviction filing indicator. PID and period FE; clustered by PID."}
plot_path <- file.path(proj_root, retaliatory_out("distlag_coefficients.png"))
if (file.exists(plot_path)) {
  knitr::include_graphics(plot_path)
} else {
  cat("Distributed lag plot not found.")
}
```

```{r distlag-table}
coef_path <- retaliatory_out("distlag_coefficients.csv")
if (file.exists(coef_path)) {
  coef_dist <- fread(coef_path)
  if (!nrow(coef_dist) || !all(c("sample", "stem", "timing", "estimate") %in% names(coef_dist))) {
    cat("Distributed lag coefficients not available (dist-lag was skipped or produced no rows).")
  } else {
    # Show t-2 through t+3 for each sample x stem
    key_timings <- coef_dist[timing >= -2 & timing <= 3]
    if (!nrow(key_timings)) {
      cat("Distributed lag coefficients not available in the requested timing window.")
    } else {
      key_wide <- dcast(key_timings,
        sample + stem ~ timing,
        value.var = "estimate"
      )
      present_timing_cols <- intersect(as.character(-2:3), names(key_wide))
      if (length(present_timing_cols)) {
        pretty_names <- c(
          "-2" = "$t-2$", "-1" = "$t-1$", "0" = "$t$", "1" = "$t+1$", "2" = "$t+2$", "3" = "$t+3$"
        )
        setnames(key_wide, old = present_timing_cols, new = unname(pretty_names[present_timing_cols]))
      }
      kable(key_wide, booktabs = TRUE, escape = FALSE, digits = 4,
            caption = "Distributed lag coefficients at $t-2$ through $t+3$") |>
        kable_styling(latex_options = c("hold_position", "scale_down"))
    }
  }
}
```

\newpage

## Same-Period Retaliation with Tenant Composition

```{r same-period-table, results='asis'}
include_tex_table(retaliatory_out("same_period_tenant_model_table.tex"))
```

## Tenant Composition Interactions

Do buildings with higher shares of Black tenants or female-headed households face more retaliatory eviction filings after a complaint? The interaction terms below test this: a positive coefficient on `Complaint Ã— % Black` means that a complaint in a building with a higher Black tenant share is associated with a larger increase in eviction filings.

```{r tenant-coefs}
tc_path <- retaliatory_out("same_period_tenant_coefficients.csv")
if (file.exists(tc_path)) {
  tc <- fread(tc_path)
  # Clean up term labels
  tc_int <- tc[spec == "tenant_augmented" & grepl("tc_|^filed_", term)]
  tc_int[, Term := fcase(
    grepl("^filed_.*:tc_black_c$|^tc_black_c:filed_", term), "Complaint x % Black",
    grepl("^filed_.*:tc_female_c$|^tc_female_c:filed_", term), "Complaint x % Female",
    grepl("^filed_.*:tc_black_female_c$|^tc_black_female_c:filed_", term), "Complaint x % Black Female",
    grepl("^filed_.*:tc_cov_c$|^tc_cov_c:filed_", term), "Complaint x Demog Coverage",
    grepl("^filed_complaint$|^filed_severe$|^filed_non_severe$", term), "Complaint (main effect)",
    default = term
  )]
  tc_show <- tc_int[,
    .(Sample = fifelse(sample == "pre", "Pre-COVID", "Full"),
      `Complaint type` = fcase(
        stem == "complaint", "Any",
        stem == "severe", "Severe",
        stem == "non_severe", "Non-severe",
        default = stem),
      Term,
      Estimate = round(estimate, 4),
      SE = round(std_error, 4),
      `$p$` = round(p_value, 3))
  ]
  kable(tc_show, booktabs = TRUE, escape = FALSE,
        caption = "Same-period retaliation: complaint main effects and tenant composition interactions") |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9)
}
```

\newpage

## Tract FE Specification (Cross-Building Variation)

The main models above use building (PID) fixed effects, identifying off *within-building* time variation in complaints and evictions. The tract FE models below replace PID FE with census tract FE, also exploiting *cross-building* variation within neighborhoods. Comparison of the two identifies whether the complaint--eviction relationship is driven by within-building dynamics or cross-sectional sorting.

```{r tract-fe-table, results='asis'}
tract_tex_path <- retaliatory_out("tract_fe_model_table.tex")
if (file.exists(tract_tex_path)) {
  include_tex_table(tract_tex_path)
} else {
  cat("Tract FE model table not found. Re-run retaliatory-evictions.r to generate.")
}
```

```{r tract-fe-coefs}
tract_path <- retaliatory_out("tract_fe_coefficients.csv")
if (file.exists(tract_path)) {
  tc_tract <- fread(tract_path)
  tc_tract_int <- tc_tract[spec == "tract_tenant_augmented" & grepl("tc_|^filed_", term)]
  tc_tract_int[, Term := fcase(
    grepl("^filed_.*:tc_black_c$|^tc_black_c:filed_", term), "Complaint x % Black",
    grepl("^filed_.*:tc_female_c$|^tc_female_c:filed_", term), "Complaint x % Female",
    grepl("^filed_.*:tc_black_female_c$|^tc_black_female_c:filed_", term), "Complaint x % Black Female",
    grepl("^filed_.*:tc_cov_c$|^tc_cov_c:filed_", term), "Complaint x Demog Coverage",
    grepl("^filed_complaint$|^filed_severe$|^filed_non_severe$", term), "Complaint (main effect)",
    default = term
  )]
  tc_tract_show <- tc_tract_int[,
    .(Sample = fifelse(sample == "pre", "Pre-COVID", "Full"),
      `Complaint type` = fcase(
        stem == "complaint", "Any",
        stem == "severe", "Severe",
        stem == "non_severe", "Non-severe",
        default = stem),
      Term,
      Estimate = round(estimate, 4),
      SE = round(std_error, 4),
      `$p$` = round(p_value, 3))
  ]
  kable(tc_tract_show, booktabs = TRUE, escape = FALSE,
        caption = "Tract FE: same-period retaliation with tenant composition interactions") |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9)
}
```

\newpage

## Retaliatory Targeting by Tenant Demographics

Among all eviction filings, are the *retaliatory* ones disproportionately concentrated in buildings with more Black or female tenants? This model conditions on **having an eviction filing** and asks whether the probability that it is retaliatory (complaint filed nearby) is higher in buildings with certain demographic compositions.

$$
\text{retaliatory}_{it} = \beta_1 \cdot \widetilde{\text{Black}}_i + \beta_2 \cdot \widetilde{\text{Female}}_i + \beta_3 \cdot \widetilde{\text{Black} \times \text{Female}}_i + \beta_4 \cdot \widetilde{\text{Coverage}}_i + \delta M_i + \alpha_{\text{geo}} + \gamma_t + \varepsilon_{it}
$$

**Sample:** Building-periods with at least one eviction filing. **Outcome:** Whether a complaint was filed in the same period ("same") or within $\pm B$ periods ("bw"). **FE:** Tract or block group.

A positive $\beta_1$ means that, among buildings filing evictions, those with more Black tenants are more likely to be retaliating against a complaint --- i.e., retaliatory eviction is disproportionately targeted at Black-occupied buildings.

```{r targeting-table, results='asis'}
tgt_tex_path <- retaliatory_out("targeting_model_table.tex")
if (file.exists(tgt_tex_path)) {
  include_tex_table(tgt_tex_path)
} else {
  cat("Targeting model table not found. Re-run retaliatory-evictions.r to generate.")
}
```

```{r targeting-coefs}
tgt_path <- retaliatory_out("targeting_coefficients.csv")
if (file.exists(tgt_path)) {
  tgt <- fread(tgt_path)
  tgt_show <- tgt[grepl("tc_", term), .(
    Sample = fifelse(sample == "pre", "Pre-COVID", "Full"),
    Outcome = fifelse(outcome == "same", "Same period", "Within BW"),
    FE = fifelse(fe == "tract", "Tract", "Block Group"),
    Term = fcase(
      grepl("tc_black_c$", term), "% Black",
      grepl("tc_female_c$", term), "% Female",
      grepl("tc_black_female_c$", term), "% Black Female",
      grepl("tc_cov_c$", term), "Demog Coverage",
      default = term),
    Estimate = round(estimate, 4),
    SE = round(std_error, 4),
    `$p$` = round(p_value, 3)
  )]
  kable(tgt_show, booktabs = TRUE, escape = FALSE,
        caption = sprintf("%s-level targeting: among %s, is retaliation more likely in Black/female buildings?",
                          period_title, eviction_periods_label)) |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9)
}
```

```{r targeting-bt-slopes}
tgt_bt_slope_path <- retaliatory_out("targeting_num_units_bin_interactions_slopes.csv")
show_bt_slope_table(
  tgt_bt_slope_path,
  caption = sprintf("%s-level targeting: total slopes for %% Black / %% Female by unit-count bin (reference = 1 unit)",
                    period_title),
  outcome_map = c(same = "Same period", bw = "Within BW")
)
```

\newpage

## Building-Year Retaliatory Share

The `r period_adj` period-level model above treats each `r period_label` as a separate observation. An alternative aggregates to the **building $\times$ year** level: for each PID-year with at least one eviction, what share of `r eviction_periods_label` are retaliatory? This is regressed on tenant demographics and building observables (log area, log market value) with FE for unit count bin, building type, construction decade, stories bin, year, and tract/BG.

$$
\text{share\_retaliatory}_{iy} = \beta_1 \cdot \widetilde{\text{Black}}_i + \beta_2 \cdot \widetilde{\text{Female}}_i + \delta' X_i + \alpha_{\text{geo}} + \gamma_y + \phi_b + \varepsilon_{iy}
$$

**Sample:** PID-years with $\geq 1$ eviction filing. **FE:** Year + tract/BG + building type + unit bin + decade built + stories bin. **Controls:** log(total area), log(market value).

```{r bldg-year-targeting-table, results='asis'}
byt_tex_path <- retaliatory_out("bldg_year_targeting_model_table.tex")
if (file.exists(byt_tex_path)) {
  include_tex_table(byt_tex_path)
} else {
  cat("Building-year targeting model table not found. Re-run retaliatory-evictions.r to generate.")
}
```

```{r bldg-year-targeting-coefs}
byt_path <- retaliatory_out("bldg_year_targeting_coefficients.csv")
if (file.exists(byt_path)) {
  byt <- fread(byt_path)
  byt_show <- byt[grepl("tc_|log_total_area|log_market_value", term), .(
    Sample = fifelse(sample == "pre", "Pre-COVID", "Full"),
    Outcome = fifelse(outcome == "same", "Same period", "Within BW"),
    FE = fifelse(fe == "tract", "Tract", "Block Group"),
    Term = fcase(
      grepl("tc_black_c$", term), "% Black",
      grepl("tc_female_c$", term), "% Female",
      grepl("tc_black_female_c$", term), "% Black Female",
      grepl("tc_cov_c$", term), "Demog Coverage",
      term == "log_total_area", "log(Area)",
      term == "log_market_value", "log(Mkt Value)",
      default = term),
    Estimate = round(estimate, 4),
    SE = round(std_error, 4),
    `$p$` = round(p_value, 3)
  )]
  kable(byt_show, booktabs = TRUE, escape = FALSE,
        caption = "Building-year targeting: share of evictions that are retaliatory by building demographics") |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9)
}
```

```{r bldg-year-targeting-bt-slopes}
byt_bt_slope_path <- retaliatory_out("bldg_year_targeting_num_units_bin_interactions_slopes.csv")
show_bt_slope_table(
  byt_bt_slope_path,
  caption = "Building-year targeting: total slopes for % Black / % Female by unit-count bin (reference = 1 unit)",
  outcome_map = c(same = "Same period", bw = "Within BW")
)
```

\newpage

## Complaint Suppression

This section now reports the **severe-complaint PPML 4-spec ladder** that we are iterating on. The goal is to track the `% Black` coefficient as we add controls, then add the lagged maintenance-stock control, and then add a lagged severe-violations stock proxy for building quality.

Outcome is `total_severe_complaints` (quarterly count). The maintenance control is a **lagged rolling stock of repair permits per unit** (electrical, plumbing, mechanical, fire suppression permits), with EWMA decay `\lambda = 0.9`.

$$
\mathbb{E}[\text{severe\_complaints}_{it}\mid X] =
\exp\left(\beta \cdot \text{pct\_black}_i + \gamma \cdot \text{maint\_stock\_lag\_rate}_{it} + \delta'X_{it} + \alpha\right)
$$

**Estimator:** PPML (`fepois`) with unit weights and PID-clustered standard errors.

**Spec ladder:**

1. `total_severe_complaints ~ infousa_pct_black | year`
2. `+ log(total_area) + tract + building type + unit bin + year_built_decade + quality_grade_abcde + year`
3. Spec (2) + `maint_stock_lag_rate_sev3`
4. Spec (3) + `severe_viol_stock_lag_rate_sev3` (EWMA lagged severe violations per unit; `unsafe + hazardous`)

**Important sample note:** these regressions restrict to `tenant_comp_missing == 0` (so missing tenant composition is not treated as `pct_black = 0`).

```{r suppression-severe-3spec-table, results='asis'}
sup_sev3_tex_path <- retaliatory_out("suppression_severe_ppml_3spec_model_table.tex")
if (file.exists(sup_sev3_tex_path)) {
  include_tex_table(sup_sev3_tex_path)
} else {
  cat("Severe complaint PPML 3-spec model table not found. Re-run retaliatory-evictions.r to generate.")
}
```

```{r suppression-severe-3spec-coefs}
sup_sev3_path <- retaliatory_out("suppression_severe_ppml_3spec_coefficients.csv")
if (file.exists(sup_sev3_path)) {
  sup_sev3 <- fread(sup_sev3_path)
  sup_sev3_show <- sup_sev3[term %chin% c("infousa_pct_black", "log_total_area", "maint_stock_lag_rate_sev3", "severe_viol_stock_lag_rate_sev3"), .(
    Model = fcase(
      model == "reg1_pct_black_year", "1. pct_black + year",
      model == "reg2_plus_building_nhood_year", "2. + building/nhood/year",
      model == "reg3_plus_maintenance_stock", "3. + maintenance stock",
      model == "reg4_plus_severe_violation_stock", "4. + severe violations stock",
      default = model
    ),
    Term = fcase(
      term == "infousa_pct_black", "Pct Black",
      term == "log_total_area", "log(total_area)",
      term == "maint_stock_lag_rate_sev3", "Lagged maintenance stock / unit",
      term == "severe_viol_stock_lag_rate_sev3", "Lagged severe violations stock / unit",
      default = term
    ),
    Estimate = round(estimate, 4),
    SE = round(std_error, 4),
    p = round(p_value, 4),
    `N obs` = n_obs,
    `N PID` = n_pid
  )]
  kable(sup_sev3_show, booktabs = TRUE,
        caption = "Severe complaint PPML 4-spec ladder: key coefficients") |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9)
}
```

```{r suppression-severe-3spec-sample}
sup_sev3_sample_path <- retaliatory_out("suppression_severe_ppml_3spec_sample.csv")
if (file.exists(sup_sev3_sample_path)) {
  sup_sev3_sample <- fread(sup_sev3_sample_path)
  sup_sev3_sample_show <- sup_sev3_sample[, .(
    Model = fcase(
      model == "reg1_pct_black_year", "1. pct_black + year",
      model == "reg2_plus_building_nhood_year", "2. + building/nhood/year",
      model == "reg3_plus_maintenance_stock", "3. + maintenance stock",
      model == "reg4_plus_severe_violation_stock", "4. + severe violations stock",
      default = model
    ),
    `N obs` = n_obs,
    `N PID` = n_pid,
    lambda = lambda
  )]
  kable(sup_sev3_sample_show, booktabs = TRUE,
        caption = "Severe complaint PPML 4-spec ladder: sample sizes and EWMA decay") |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9)
}
```

```{r suppression-severe-3spec-missingness}
sup_sev3_miss_path <- retaliatory_out("suppression_severe_ppml_3spec_pct_black_missingness.csv")
if (file.exists(sup_sev3_miss_path)) {
  sup_sev3_miss <- fread(sup_sev3_miss_path)
  miss_show <- sup_sev3_miss[stage %chin% c("panel_all", "reg1_sample", "reg2_3_sample"), .(
    Stage = fcase(
      stage == "panel_all", "All panel rows",
      stage == "reg1_sample", "Reg 1 sample",
      stage == "reg2_3_sample", "Reg 2/3 sample",
      default = stage
    ),
    `N obs` = n_obs,
    `N PID` = n_pid,
    `pct_black missing` = round(100 * share_tenant_black_missing, 1),
    `any tenant comp missing` = round(100 * share_tenant_comp_missing, 1),
    `log(total_area) missing` = round(100 * share_log_total_area_missing, 1),
    `tract missing` = round(100 * share_missing_tract, 1)
  )]
  kable(miss_show, booktabs = TRUE,
        caption = "Severe complaint PPML 4-spec ladder: pct black / controls missingness by sample stage (percent)") |>
    kable_styling(latex_options = c("hold_position", "scale_down"), font_size = 9)
}
```

# Interpretation

The distributed lag model tests whether eviction filings increase *after* a complaint is filed --- a temporal pattern consistent with landlord retaliation. The key coefficients are the positive leads ($k > 0$), which indicate elevated eviction filings in the periods following a complaint.

The same-period model estimates the contemporaneous correlation, while the tenant-composition augmented version tests whether retaliatory behavior differs by the racial or gender composition of the building's tenants.

The tract FE models provide a less restrictive comparison: if the PID FE and tract FE estimates are similar, the complaint--eviction relationship is not merely a cross-sectional feature of buildings that both complain and evict at higher rates; it persists within the same building over time.

The **retaliatory targeting** analysis flips the question: among evictions that do happen, are retaliatory ones disproportionately concentrated in buildings with more Black/female tenants? This directly tests whether retaliation is a mechanism of demographic targeting.

The **complaint suppression** analysis (current iteration) focuses on a severe-complaint PPML 4-spec ladder: first `% Black + year`, then adding building/neighborhood controls, then adding lagged maintenance stock per unit, and then adding a lagged severe-violations stock proxy for building quality. We also report a `pct_black` missingness table so coefficient shifts can be interpreted alongside sample selection.

The bandwidth analysis provides a complementary non-parametric measure: what fraction of eviction filings are "plausibly retaliatory" (occurring within $b$ periods of a complaint)?
